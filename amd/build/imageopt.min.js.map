{"version":3,"file":"imageopt.min.js","sources":["../src/imageopt.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   filter_imgopt\n * @copyright Copyright (c) 2017 Guy Thomas\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Main initialising function.\n */\ndefine(['filter_imageopt/appear'],\n    function($) {\n        return {\n            init: function() {\n\n                /**\n                 * Load optimised image.\n                 * @param {Element} el\n                 * @param {string} imgurl\n                 * @returns {void}\n                 */\n                var loadOptimisedImg = function(el, imgurl) {\n                    $(el).attr('src', imgurl);\n                    $(el).removeAttr('data-loadonvisible');\n                    $(el).addClass('imageopt_loading');\n                    $(el).on('load', function() {\n                        $(el).removeClass('imageopt_loading');\n                    });\n                };\n\n                $(document).ready(function() {\n                    $(document.body).on('appear', 'img[data-loadonvisible]', function(e, appeared) {\n                        appeared.each(function() {\n                            var imgurl = $(this).data('loadonvisible');\n                            loadOptimisedImg(this, imgurl);\n                        });\n                    });\n                    // Appear configuration - start loading images when they are out of the view port by 400px.\n                    var appearConf = {appeartopoffset: 100, appearleftoffset: 100};\n                    $('img[data-loadonvisible]').appear(appearConf);\n                    $.force_appear();\n\n                    /**\n                     * Listen for hash changes / popstates.\n                     */\n                    (function() {\n                        var lastHash = location.hash;\n                        $(window).on('popstate hashchange', function() {\n                            var newHash = location.hash;\n                            if (newHash !== lastHash) {\n                                window.setTimeout(\n                                    function() {\n                                        $.force_appear();\n                                    },\n                                    200\n                                );\n                            }\n                            lastHash = newHash;\n                        });\n                    })();\n\n                });\n            }\n        };\n    }\n);\n"],"names":["define","$","init","document","ready","body","on","e","appeared","each","el","imgurl","attr","removeAttr","addClass","removeClass","loadOptimisedImg","this","data","lastHash","appear","appeartopoffset","appearleftoffset","force_appear","location","hash","window","newHash","setTimeout"],"mappings":";;;;;;;;;;;;;;;;;;;;AAwBAA,kCAAO,CAAC,2BACJ,SAASC,SACE,CACHC,KAAM,WAiBFD,EAAEE,UAAUC,OAAM,WACdH,EAAEE,SAASE,MAAMC,GAAG,SAAU,2BAA2B,SAASC,EAAGC,UACjEA,SAASC,MAAK,YAXC,SAASC,GAAIC,QAChCV,EAAES,IAAIE,KAAK,MAAOD,QAClBV,EAAES,IAAIG,WAAW,sBACjBZ,EAAES,IAAII,SAAS,oBACfb,EAAES,IAAIJ,GAAG,QAAQ,WACbL,EAAES,IAAIK,YAAY,uBAQdC,CAAiBC,KADJhB,EAAEgB,MAAMC,KAAK,4BAa1BC,SAPRlB,EAAE,2BAA2BmB,OADZ,CAACC,gBAAiB,IAAKC,iBAAkB,MAE1DrB,EAAEsB,eAMMJ,SAAWK,SAASC,KACxBxB,EAAEyB,QAAQpB,GAAG,uBAAuB,eAC5BqB,QAAUH,SAASC,KACnBE,UAAYR,UACZO,OAAOE,YACH,WACI3B,EAAEsB,iBAEN,KAGRJ,SAAWQ"}